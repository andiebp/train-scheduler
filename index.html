<!DOCTYPE html>

<head>
    <style type="text/css"></style>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</head>

<body>
    <script src="https://www.gstatic.com/firebasejs/4.3.0/firebase.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.js"></script>
    <script>
        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyDlV1w0wOLyMSI32CMeLk4zi7UkwSxujUE",
            authDomain: "my-firebase-app-c4cc5.firebaseapp.com",
            databaseURL: "https://my-firebase-app-c4cc5.firebaseio.com",
            projectId: "my-firebase-app-c4cc5",
            storageBucket: "my-firebase-app-c4cc5.appspot.com",
            messagingSenderId: "650319596674"
        };
        firebase.initializeApp(config);

    </script>

    <div class="container">
        <div class="jumbotron">
            <h1>Anytime is Train Time</h1>
            <p>Choo Choo. Chee Chee!</p>
        </div>

        <div class="panel-default panel">
            <div class="panel-heading">Current Train Schedule
            </div>
            <div class="panel-body">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Train Name</th>
                            <th>Destination</th>
                            <th>Frequency (min)</th>
                            <th>Next Arrival</th>
                            <th>Minutes Away</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <tr id="name-display"></tr>
                            <tr id="destination-display"></tr>
                            <th id="frequency-display"></th>
                            <th id="next-arrival"></th>
                            <th id="minutes-away"></th>
                        </tr>
                    </tbody>
                </table>

            </div>


        </div>
        <div class="panel-default panel">
            <div class="panel-heading">Add Train
            </div>
            <div class="entry-form">
                <form>
                    <div class="form-group">
                        <label for="name">Train Name</label>
                        <input type="text" class="form-control" id="name">
                    </div>
                    <div class="form-group">
                        <label for="role">Destination</label>
                        <input type="text" class="form-control" id="role">
                    </div>
                    <div class="form-group">
                        <label for="start">First Train Time (HH:mm - military time)</label>
                        <input type="text" class="form-control" id="start">
                    </div>
                    <div class="form-group">
                        <label for="rate">Frequency (min)</label>
                        <input type="number" class="form-control" id="rate">
                    </div>
                    <button type="submit" class="btn btn-default" id="submit-button">Submit</button>
                </form>
            </div>
        </div>

    </div>

    <script type="text/javascript">
        var database = firebase.database();

        $("#submit-button").click(function() {
            event.preventDefault();
            var newName = $("#name").val();
            var newDestination = $("#role").val();
            var newStart = moment($("#start").val().trim(), "DD/MM/YY").format("X");
            var newRate = $("#rate").val();
            var emp = {
                name: newName,
                role: newRole,
                start: newStart,
                rate: newRate
            }
            console.log(emp);

            database.ref().push(emp);
            alert("Train added");

            $("#name").val("");
            $("#role").val("");
            $("#start").val("");
            $("#rate").val("");
        });

        database.ref().on("child_added", function(childSnapshot, prevChildKey) {
            console.log(childSnapshot.val());

            $("#name-display").append("<tr>childSnapshot.val().name</tr>");
            $("#role-display").append(childSnapshot.val().role);
            $("#start-display").append(childSnapshot.val().start);
            //$("#months-display").html(childSnapshot.val().month);
            $("#rate-display").append(childSnapshot.val().rate);
            //$("#bill-display").html(childSnapshot.val().bill);
        });

    </script>
</body>


</html>
